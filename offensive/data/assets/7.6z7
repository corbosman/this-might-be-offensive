/*! original file: thismight.be/offensive/js/maps.js */
var maxxerIcon=new GIcon();maxxerIcon.image="/offensive/graphics/map_man_blue.png";maxxerIcon.shadow="/offensive/graphics/map_man_shadow.png";maxxerIcon.iconSize=new GSize(23,23);maxxerIcon.shadowSize=new GSize(40,23);maxxerIcon.iconAnchor=new GPoint(12,23);maxxerIcon.infoWindowAnchor=new GPoint(14,6);maxxerIcon.infoShadowAnchor=new GPoint(20,23);var clusterIcon=new GIcon(maxxerIcon);clusterIcon.image="/offensive/graphics/map_cluster.png";clusterIcon.iconSize=new GSize(27,27);clusterIcon.shadowSize=new GSize(48,27);clusterIcon.iconAnchor=new GPoint(12,25);var map;var geocoder;var sidebar_html="";var gmarkers=[];var mgr;var find_id=-1;var click_id;function myclick(a){map.setCenter(gmarkers[a].getPoint(),8);GDownloadUrl("/offensive/map/get_userinfo.php?user="+gmarkers[a].id,function(b){map.openInfoWindow(gmarkers[a].getLatLng(),b,{pixelOffset:new GSize(5,-20)})})}function posse_click(b){for(var a=0;a<gmarkers.length;a++){if(gmarkers[a].id==b){myclick(a);break}}}function loadmap(){if(GBrowserIsCompatible()){var b=0;function e(f,i,h){var g=new GMarker(f,{icon:maxxerIcon,title:i});g.user=i;g.id=h;g.type="marker";if(find_id==h){click_id=b;window.setTimeout(function(){myclick(click_id)},2000)}gmarkers[b]=g;sidebar_html+='<a  href="javascript:myclick('+b+')">'+i+"</a> &nbsp;";b++;return g}function a(l,n,h,g,j,i){var m=new GMarker(l,{icon:clusterIcon,title:n+" maxxers"});m.type="cluster";var f=j+((j-h)/2);var k=i+((i-g)/2);m.swx=h-(f-h);m.swy=g-(k-g);m.nex=j+(f-h);m.ney=i+(k-g);return(m)}map=new GMap2(document.getElementById("map"));map.addMapType(G_PHYSICAL_MAP);map.addControl(new GLargeMapControl());map.addControl(new GMapTypeControl());map.addControl(new GScaleControl());map.enableScrollWheelZoom();var d=new GControlPosition(G_ANCHOR_BOTTOM_LEFT,new GSize(200,5));d.apply(document.getElementById("map_edit"));map.getContainer().appendChild(document.getElementById("map_edit"));map.setCenter(new GLatLng(0,0),1,G_SATELLITE_MAP);var c={borderPadding:5};mgr=new MarkerManager(map,c);GDownloadUrl("/offensive/map/get_coordinates.php",function(q){var r=GXml.parse(q);var m=r.documentElement.getElementsByTagName("marker");var i=[];var h=[];var u;for(var l=0;l<18;l++){i[l]=[];h[l]=[]}for(var n=0;n<m.length;n++){var g=m[n].getAttribute("user");var p=m[n].getAttribute("userid");var t=parseInt(m[n].getAttribute("minzoom"));var w=new GLatLng(parseFloat(m[n].getAttribute("lat")),parseFloat(m[n].getAttribute("lon")));var o=e(w,g,p);i[t].push(o)}document.getElementById("sidebar").innerHTML=sidebar_html;var s=r.documentElement.getElementsByTagName("cluster");for(var n=0;n<s.length;n++){var f=parseInt(s[n].getAttribute("level"));var w=new GLatLng(parseFloat(s[n].getAttribute("lat")),parseFloat(s[n].getAttribute("lon")));var v=a(w,s[n].getAttribute("num_users"),parseFloat(s[n].getAttribute("swx")),parseFloat(s[n].getAttribute("swy")),parseFloat(s[n].getAttribute("nex")),parseFloat(s[n].getAttribute("ney")));h[f].push(v)}for(b=0;b<18;b++){mgr.addMarkers(i[b],b);mgr.addMarkers(h[b],b,b)}mgr.refresh()});GEvent.addListener(map,"click",function(h,f,l){var k="";if(h){if(h instanceof GMarker){if(h.type=="cluster"){var i=new GLatLngBounds();var g=new GLatLng(h.swx,h.swy);var j=new GLatLng(h.nex,h.ney);i.extend(g);i.extend(j);map.setZoom(map.getBoundsZoomLevel(i));map.setCenter(i.getCenter())}else{GDownloadUrl("/offensive/map/get_userinfo.php?user="+h.id,function(m){h.openInfoWindowHtml(m)})}}}else{if(f){}}})}else{alert("Your browser is not compatible")}}function editmap(a){if(GBrowserIsCompatible()){map=new GMap2(document.getElementById("map"));map.addControl(new GLargeMapControl());map.addControl(new GMapTypeControl());map.enableScrollWheelZoom();map.setCenter(new GLatLng(0,0),1,G_SATELLITE_MAP);var c=new GControlPosition(G_ANCHOR_BOTTOM_LEFT,new GSize(200,5));c.apply(document.getElementById("map_edit"));map.getContainer().appendChild(document.getElementById("map_edit"));geocoder=new GClientGeocoder();function b(d,g,f,h){var e=new GMarker(d,{icon:maxxerIcon,title:g});e.user=g;e.id=f;return e}GDownloadUrl("/offensive/map/get_coordinate.php?user="+a,function(g){var k=GXml.parse(g);var e=k.documentElement.getElementsByTagName("marker");for(var h=0;h<e.length;h++){var d=e[h].getAttribute("user");var j=e[h].getAttribute("userid");var l=maxxerIcon;var m=new GLatLng(parseFloat(e[h].getAttribute("lat")),parseFloat(e[h].getAttribute("lon")));map.setCenter(m,8,G_SATELLITE_MAP);var f=b(m,d,j,l);map.addOverlay(f)}});GEvent.addListener(map,"click",function(g,e){var i="";if(g){if(g instanceof GMarker){map.removeOverlay(g);GDownloadUrl("/offensive/map/user_delete.php",function(j){})}}else{if(e){map.clearOverlays();var d=new GMarker(e,{icon:maxxerIcon});map.addOverlay(d);var h=d.getPoint().lat();var f=d.getPoint().lng();GDownloadUrl("/offensive/map/user_add.php?lat="+h+"&long="+f,function(j){})}}})}else{alert("Your browser is not compatible")}}function showAddress(a){if(geocoder){geocoder.getLatLng(a,function(b){if(!b){alert(a+" not found")}else{map.setCenter(b,15)}})}}window.onunload=function(){GUnload()};