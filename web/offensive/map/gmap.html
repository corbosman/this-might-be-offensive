<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8"/>
    <title>Google Maps JavaScript API Example</title>
    <script src="http://maps.google.com/maps?file=api&amp;v=2&amp;key=ABQIAAAAiLrNiTQTZlY9-a3cY0h3vBRk1r88Hrq2n74rpCHBF8iHJqU5OBRFTMsCD4pR4wEehvSKSO3kXYsg8g"
      type="text/javascript"></script>
    <script type="text/javascript">

    //<![CDATA[

    function load() {
      if (GBrowserIsCompatible()) {
        var map = new GMap2(document.getElementById("map"));
        map.setCenter(new GLatLng(35.55, -97.554101), 2);
        map.addControl(new GSmallMapControl());
		map.addControl(new GMapTypeControl());
		
		// Create our "tiny" marker icon
		var icon = new GIcon();
		icon.image = "http://labs.google.com/ridefinder/images/mm_20_red.png";
		icon.shadow = "http://labs.google.com/ridefinder/images/mm_20_shadow.png";
		icon.iconSize = new GSize(12, 20);
		icon.shadowSize = new GSize(22, 20);
		icon.iconAnchor = new GPoint(6, 20);
		icon.infoWindowAnchor = new GPoint(5, 1);

/*		
		// Add 10 markers to the map at random locations
		var bounds = map.getBounds();
		var southWest = bounds.getSouthWest();
		var northEast = bounds.getNorthEast();
		var lngSpan = northEast.lng() - southWest.lng();
		var latSpan = northEast.lat() - southWest.lat();
		for (var i = 0; i < 10; i++) {
		  var point = new GLatLng(southWest.lat() + latSpan * Math.random(),
								  southWest.lng() + lngSpan * Math.random());
		  map.addOverlay(new GMarker(point, icon));
		}
*/

		GEvent.addListener(map, "click", function() {
				setLocation( map.getCenter().x, map.getCenter().y );
			}
		);
		
	}
	
	function setLocation( x, y ) {
		makeRequest( "./gmap.php?x=" + x + "&y=" + y, function( req ) {
			alert( req.status );
		});
	}
	
	////////////////////////////////////////////////////////////////////////////////////////////////////
	// makeRequest-- submits an asynchronous http request to the specified url and invokes callbackFunc
	// upon completion
	//  @param url - the url of the request
	//  @param callbackFunc the function to be called upon completion of the request. The function will
	//        receive the XmlHttpRequest object as an argument.
	//  @param isAsynch - optional boolean to make a synchronous or asynchronous call; if null, default
	//							to "asynchronous"
	////////////////////////////////////////////////////////////////////////////////////////////////////
	function makeRequest(url, callbackFunc, isAsynch) {
		http_request = false;
		if (window.XMLHttpRequest) { // Mozilla, Safari,...
			http_request = new XMLHttpRequest();
			if (http_request.overrideMimeType) {
				http_request.overrideMimeType('text/xml');
			}
		}
		else if (window.ActiveXObject) { // IE
			try {
				http_request = new ActiveXObject("Msxml2.XMLHTTP");
			} catch (e) {
				try {
					http_request = new ActiveXObject("Microsoft.XMLHTTP");
				} catch (e) {}
			}
		}
		if (!http_request) {
			alert('Cannot create XMLHTTP instance');
			return false;
		}
		http_request.onreadystatechange = function() { 
			if( http_request.readyState == 4 ) {
				callbackFunc( http_request );
			}
		};
		
		var async = (isAsynch != null) ? isAsynch : true;
		http_request.open('GET', url, async);
		http_request.send(null);
	}

	

}
    //]]>
    </script>
  </head>
  <body onload="load()" onunload="GUnload()">
    <div id="map" style="width: 800px; height: 500px"></div>
  </body>
</html>
